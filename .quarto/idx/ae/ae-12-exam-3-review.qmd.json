{"title":"AE 12: Exam 3 Review","markdown":{"yaml":{"title":"AE 12: Exam 3 Review"},"headingText":"Introduction","containsRefs":false,"markdown":"\n\n::: callout-important\nGo to the [course GitHub organization](https://github.com/sta210-s22) and locate the repo titled `ae-12-exam-3-review-YOUR_GITHUB_USERNAME` to get started.\n:::\n\n\n## Packages\n\n```{r}\n#| label: load-pkgs\n#| message: false\n \nlibrary(tidyverse)\nlibrary(tidymodels)\nlibrary(knitr)\nlibrary(Stat2Data)\nlibrary(rms)\nlibrary(nnet)\n```\n\n## Data\n\nAs part of a study of the effects of predatory intertidal crab species on snail populations, researchers measured the mean closing forces and the propodus heights of the claws on several crabs of three species.\n\n![](images/paste-7BA685C6.png){width=\"300\"}\n\n```{r}\n#| warning: false\n\nclaws <- read_csv(here::here(\"ae\", \"data/claws.csv\"))\n```\n\nWe will use the following variables:\n\n-   `force`: Closing force of claw (newtons)\n-   `height`: Propodus height (mm)\n-   `species`: Crab species - Cp(Cancer productus), Hn (Hemigrapsus nudus), Lb(Lophopanopeus bellus)\n-   `lb`: 1 if Lophopanopeus bellus species, 0 otherwise\n-   `hn`: 1 if Hemigrapsus nudus species, 0 otherwise\n-   `cp`: 1 if Cancer productus species, 0 otherwise\n-   `force_cent`: mean centered force\n-   `height_cent`: mean centered height\n\nBefore we get started, let's make the categorical and indicator variables factors.\n\n```{r}\nclaws <- claws %>%\n  mutate(\n    species = as_factor(species),\n    lb = as_factor(lb),\n    hn = as_factor(hn),\n    cp = as_factor(cp)\n  )\n```\n\n\\pagebreak\n\n# Part 1\n\n## Probabilities vs. odds vs. log-odds\n\nWhy we use log-odds as response variable: <https://sta210-s22.github.io/website/slides/lec-18.html#/do-teenagers-get-7-hours-of-sleep>\n\n## Exercise 1\n\nFill in the blanks:\n\n-   Use log-odds to fit the model (outcome)\n-   Use odds to interpret model results\n-   Use probabilities to make predictions for individual observations and ultimately to make classification decisions\n\n## Exercise 2\n\nSuppose we want to use force to determine whether or not a crab is from the Lophopanopeus bellus (Lb) species.\nWhy should we use a logistic regression model for this analysis?\n\n```{r}\nclaws %>%\n  distinct(lb)\n```\n\n## Exercise 3\n\nWe will use the mean-centered variables for force in the model.\nThe model output is below.\nWrite the equation of the model produced by R.\nDon't forget to fill in the blanks for `…`.\n\n```{r echo = F}\nlb_fit_1 <- logistic_reg() %>%\n  set_engine(\"glm\") %>%\n  fit(lb ~ force_cent, data = claws)\n\ntidy(lb_fit_1, conf.int = TRUE) %>%\n  kable(digits = 3)\n```\n\nLet $\\pi$ be probability that a crab is from Lb species.\n\n$$\n\\log\\Big(\\frac{\\hat{\\pi}}{1 - \\hat{\\pi}}\\Big) = -0.798 + 0.043 * force\\_cent\n$$\n\n## Exercise 4\n\nInterpret the intercept in the context of the data.\n\n```{r}\nmean_force <- round(mean(claws$force), 2)\n```\n\nFor crabs with average closing force (`r mean_force` newtons), we expect odds of the crab being *Lophopanopeus bellus* is `r round(exp(-0.798), 2)` (`exp(-0.798)`).\n\n## Exercise 5\n\nInterpret the effect of force in the context of the data.\n\nWhen x goes up by 1 unit, we expect y to change by (slope) units.\n\nFor each additional unit increase in closing force, the odds of crab being from lb species multiplies on average by a factor of `r exp(0.043)`.\n\n## Exercise 6\n\nNow let's consider adding `height_cent` to the model.\nFit the model that includes `height_cent`.\nThen use AIC to choose the model that best fits the data.\n\n```{r}\nlb_fit_2 <- logistic_reg() %>%\n  set_engine(\"glm\") %>%\n  fit(lb ~ force_cent + height_cent, data = claws)\n\ntidy(lb_fit_2, conf.int = TRUE)\n\nglance(lb_fit_1)$AIC\nglance(lb_fit_2)$AIC\n```\n\n## Exercise 7\n\nWhat do the following mean in the context of this data.\nExplain and calculate them.\n\n-   Sensitivity: P(predict lb \\| actual lb) = 6 / 12\n-   Specificity: P(predict not lb \\| actual not lb) = 4/ 26\n-   Negative predictive power: P(actual not lb \\| predict not lb) = 22 / 28\n-   Positive predictive power: P(actual lb \\| predict lb) = 6 / 10\n\n| Actual       | Predict lb | Predict not lb | TOTAL predicted |\n|--------------|------------|----------------|-----------------|\n| Lb           | 6          | 6              | 12              |\n| Not lb       | 4          | 22             | 26              |\n| TOTAL actual | 10         | 28             | 38              |\n\n\\pagebreak\n\n# Part 2\n\nLet's extend the model to use force and height to predict the species (Hn, Cp, and Lb).\nThe model output is below:\n\n```{r}\nspecies_fit <- multinom_reg() %>%\n  set_engine(\"nnet\") %>%\n  fit(species ~ force_cent + height_cent, data = claws)\n\nspecies_fit <- repair_call(species_fit, data = claws)\n\ntidy(species_fit, conf.int = TRUE)\n```\n\n## Exercise 8\n\nWrite the equation of the model.\n\n$$\\log\\Big(\\frac{\\hat{\\pi}_{Hn}}{\\hat{\\pi}_{Cp}}\\Big) = $$\n\n$$\\log\\Big(\\frac{\\hat{\\pi}_{Lb}}{\\hat{\\pi}_{Cp}}\\Big) = $$\n\n## Exercise 9\n\n-   Interpret the intercept for the odds a crab is Hn vs. Cp species.\n\n-   Interpret the effect of force on the odds a crab is Lb vs. Cp species.\n\n## Exercise 10\n\nInterpret the effect of force on the odds a crab is in the Hn vs. Lb species.\n\nCAUTION: We can write an interpretation based on the estimated coefficients; however, we can't make any inferential conclusions for this question based on the current model.\nWe would need to refit the model with Lb as the baseline category to do so.\n\n\\pagebreak\n\n## Exercise 11\n\nConditions for multinomial logistic (and logistic models as well):\n\n-   Independence:\n-   Randomness:\n-   Linearity:\n\n```{r}\n#| layout-ncol: 2\n\nemplogitplot1(lb ~ force, data = claws, ngroups = 10)\nemplogitplot1(lb ~ height, data = claws, ngroups = 10)\n```\n\n```{r}\n#| layout-ncol: 2\n\n# add code here for other species here\n```\n\n```{r}\n#| layout-ncol: 2\n\n# add code here for other species here\n```\n\n\\pagebreak\n\n# Part 3\n\n## Checking for multicollinearity in logistic and multinomial logistic\n\nSimilar to multiple linear regression, we can also check for multicollinearity in logistic and multinomial logistic models.\n\n-   Use the `vif` function to check for multicollinearity in logistic regression.\n\n```{r}\n\n```\n\n-   The `vif` function doesn't work for the multinomial logistic regression models, so we can look at a correlation matrix of the predictors as a way to assess if the predictors are highly correlated:\n\n```{r}\n\n```\n","srcMarkdownNoYaml":"\n\n::: callout-important\nGo to the [course GitHub organization](https://github.com/sta210-s22) and locate the repo titled `ae-12-exam-3-review-YOUR_GITHUB_USERNAME` to get started.\n:::\n\n# Introduction\n\n## Packages\n\n```{r}\n#| label: load-pkgs\n#| message: false\n \nlibrary(tidyverse)\nlibrary(tidymodels)\nlibrary(knitr)\nlibrary(Stat2Data)\nlibrary(rms)\nlibrary(nnet)\n```\n\n## Data\n\nAs part of a study of the effects of predatory intertidal crab species on snail populations, researchers measured the mean closing forces and the propodus heights of the claws on several crabs of three species.\n\n![](images/paste-7BA685C6.png){width=\"300\"}\n\n```{r}\n#| warning: false\n\nclaws <- read_csv(here::here(\"ae\", \"data/claws.csv\"))\n```\n\nWe will use the following variables:\n\n-   `force`: Closing force of claw (newtons)\n-   `height`: Propodus height (mm)\n-   `species`: Crab species - Cp(Cancer productus), Hn (Hemigrapsus nudus), Lb(Lophopanopeus bellus)\n-   `lb`: 1 if Lophopanopeus bellus species, 0 otherwise\n-   `hn`: 1 if Hemigrapsus nudus species, 0 otherwise\n-   `cp`: 1 if Cancer productus species, 0 otherwise\n-   `force_cent`: mean centered force\n-   `height_cent`: mean centered height\n\nBefore we get started, let's make the categorical and indicator variables factors.\n\n```{r}\nclaws <- claws %>%\n  mutate(\n    species = as_factor(species),\n    lb = as_factor(lb),\n    hn = as_factor(hn),\n    cp = as_factor(cp)\n  )\n```\n\n\\pagebreak\n\n# Part 1\n\n## Probabilities vs. odds vs. log-odds\n\nWhy we use log-odds as response variable: <https://sta210-s22.github.io/website/slides/lec-18.html#/do-teenagers-get-7-hours-of-sleep>\n\n## Exercise 1\n\nFill in the blanks:\n\n-   Use log-odds to fit the model (outcome)\n-   Use odds to interpret model results\n-   Use probabilities to make predictions for individual observations and ultimately to make classification decisions\n\n## Exercise 2\n\nSuppose we want to use force to determine whether or not a crab is from the Lophopanopeus bellus (Lb) species.\nWhy should we use a logistic regression model for this analysis?\n\n```{r}\nclaws %>%\n  distinct(lb)\n```\n\n## Exercise 3\n\nWe will use the mean-centered variables for force in the model.\nThe model output is below.\nWrite the equation of the model produced by R.\nDon't forget to fill in the blanks for `…`.\n\n```{r echo = F}\nlb_fit_1 <- logistic_reg() %>%\n  set_engine(\"glm\") %>%\n  fit(lb ~ force_cent, data = claws)\n\ntidy(lb_fit_1, conf.int = TRUE) %>%\n  kable(digits = 3)\n```\n\nLet $\\pi$ be probability that a crab is from Lb species.\n\n$$\n\\log\\Big(\\frac{\\hat{\\pi}}{1 - \\hat{\\pi}}\\Big) = -0.798 + 0.043 * force\\_cent\n$$\n\n## Exercise 4\n\nInterpret the intercept in the context of the data.\n\n```{r}\nmean_force <- round(mean(claws$force), 2)\n```\n\nFor crabs with average closing force (`r mean_force` newtons), we expect odds of the crab being *Lophopanopeus bellus* is `r round(exp(-0.798), 2)` (`exp(-0.798)`).\n\n## Exercise 5\n\nInterpret the effect of force in the context of the data.\n\nWhen x goes up by 1 unit, we expect y to change by (slope) units.\n\nFor each additional unit increase in closing force, the odds of crab being from lb species multiplies on average by a factor of `r exp(0.043)`.\n\n## Exercise 6\n\nNow let's consider adding `height_cent` to the model.\nFit the model that includes `height_cent`.\nThen use AIC to choose the model that best fits the data.\n\n```{r}\nlb_fit_2 <- logistic_reg() %>%\n  set_engine(\"glm\") %>%\n  fit(lb ~ force_cent + height_cent, data = claws)\n\ntidy(lb_fit_2, conf.int = TRUE)\n\nglance(lb_fit_1)$AIC\nglance(lb_fit_2)$AIC\n```\n\n## Exercise 7\n\nWhat do the following mean in the context of this data.\nExplain and calculate them.\n\n-   Sensitivity: P(predict lb \\| actual lb) = 6 / 12\n-   Specificity: P(predict not lb \\| actual not lb) = 4/ 26\n-   Negative predictive power: P(actual not lb \\| predict not lb) = 22 / 28\n-   Positive predictive power: P(actual lb \\| predict lb) = 6 / 10\n\n| Actual       | Predict lb | Predict not lb | TOTAL predicted |\n|--------------|------------|----------------|-----------------|\n| Lb           | 6          | 6              | 12              |\n| Not lb       | 4          | 22             | 26              |\n| TOTAL actual | 10         | 28             | 38              |\n\n\\pagebreak\n\n# Part 2\n\nLet's extend the model to use force and height to predict the species (Hn, Cp, and Lb).\nThe model output is below:\n\n```{r}\nspecies_fit <- multinom_reg() %>%\n  set_engine(\"nnet\") %>%\n  fit(species ~ force_cent + height_cent, data = claws)\n\nspecies_fit <- repair_call(species_fit, data = claws)\n\ntidy(species_fit, conf.int = TRUE)\n```\n\n## Exercise 8\n\nWrite the equation of the model.\n\n$$\\log\\Big(\\frac{\\hat{\\pi}_{Hn}}{\\hat{\\pi}_{Cp}}\\Big) = $$\n\n$$\\log\\Big(\\frac{\\hat{\\pi}_{Lb}}{\\hat{\\pi}_{Cp}}\\Big) = $$\n\n## Exercise 9\n\n-   Interpret the intercept for the odds a crab is Hn vs. Cp species.\n\n-   Interpret the effect of force on the odds a crab is Lb vs. Cp species.\n\n## Exercise 10\n\nInterpret the effect of force on the odds a crab is in the Hn vs. Lb species.\n\nCAUTION: We can write an interpretation based on the estimated coefficients; however, we can't make any inferential conclusions for this question based on the current model.\nWe would need to refit the model with Lb as the baseline category to do so.\n\n\\pagebreak\n\n## Exercise 11\n\nConditions for multinomial logistic (and logistic models as well):\n\n-   Independence:\n-   Randomness:\n-   Linearity:\n\n```{r}\n#| layout-ncol: 2\n\nemplogitplot1(lb ~ force, data = claws, ngroups = 10)\nemplogitplot1(lb ~ height, data = claws, ngroups = 10)\n```\n\n```{r}\n#| layout-ncol: 2\n\n# add code here for other species here\n```\n\n```{r}\n#| layout-ncol: 2\n\n# add code here for other species here\n```\n\n\\pagebreak\n\n# Part 3\n\n## Checking for multicollinearity in logistic and multinomial logistic\n\nSimilar to multiple linear regression, we can also check for multicollinearity in logistic and multinomial logistic models.\n\n-   Use the `vif` function to check for multicollinearity in logistic regression.\n\n```{r}\n\n```\n\n-   The `vif` function doesn't work for the multinomial logistic regression models, so we can look at a correlation matrix of the predictors as a way to assess if the predictors are highly correlated:\n\n```{r}\n\n```\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":"auto","echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"wrap","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"output-file":"ae-12-exam-3-review.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.450","editor":"visual","theme":{"light":["cosmo","../theme.scss"],"dark":["cosmo","../theme-dark.scss"]},"mainfont":"Atkinson Hyperlegible","code-copy":true,"title":"AE 12: Exam 3 Review"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}