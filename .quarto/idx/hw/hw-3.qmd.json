{"title":"HW 3 - Logistic regression and log transformation","markdown":{"yaml":{"title":"HW 3 - Logistic regression and log transformation","subtitle":"Due Friday, March 25, 5pm on Gradescope","editor":"visual"},"headingText":"Introduction","containsRefs":false,"markdown":"\n\n\nIn this assignment, you'll get to put into practice the logistic regression skills you've developed.\n\n### Learning goals\n\nIn this assignment, you will...\n\n-   Fit and interpret logistic regression models.\n-   Fit and interpret multiple linear regression models with log transformed outcomes.\n-   Reason around log transformations of various types.\n-   Continue developing a workflow for reproducible data analysis.\n\n### Getting started\n\nYour repo for this assignment is at [github.com/sta210-s22](https://github.com/sta210-s22 \"Course GitHub organization\") and starts with the prefix **hw-3**.\nFor more detailed instructions on getting started, see [HW 1](hw-1.html).\n\n### Packages\n\nThe following packages will be used in this assignment.\nYou can add other packages as needed.\n\n```{r}\n#| message: false\n\nlibrary(tidyverse)\nlibrary(tidymodels)\nlibrary(knitr)\nlibrary(palmerpenguins)\n```\n\n## Part 1 - Palmer penguins\n\nIn this part we'll go back to the Palmer penguins dataset from [HW 2](hw-2.html).\n\nWe will use the following variables:\n\n| variable          | class   | description                                      |\n|:--------------|:--------------|:-----------------------------------------|\n| species           | integer | Penguin species (Adelie, Gentoo, Chinstrap)      |\n| island            | integer | Island where recorded (Biscoe, Dream, Torgersen) |\n| flipper_length_mm | integer | Flipper length in mm                             |\n\nThe goal of this analysis is to use logistic regression to understand the relationship between flipper length, island, and whether a penguin is from the Adelie species.\nFirst, we need to create a new response variable to identify whether a penguin is from the Adelie species.\n\n```{r}\npenguins <- penguins %>%\n  mutate(adelie = factor(if_else(species == \"Adelie\", 1, 0)))\n```\n\nAnd let's check to make sure the new variable looks right before we continue with the analysis.\n\n```{r}\npenguins %>%\n  count(adelie, species)\n```\n\nLet's start by looking at the relationship between island and whether a penguin is from the Adelie species.\n\n1.  What does the `values_fill` argument do in the following chunk?\n    The documentation for the function will be helpful in answering this question.\n\n    ```{r}\n    penguins %>%\n      count(island, adelie) %>%\n      pivot_wider(names_from = adelie, values_from = n, values_fill = 0)\n    ```\n\n2.  Calculate the odds ratio of a penguin being from the Adelie species for those recorded on Dream compared to those recorded on Biscoe.\n\n3.  You want to fit a model using `island` to predict the odds of being from the Adelie species.\n    Let $\\pi$ be the probability a penguin is from the Adelie species.\n    The model has the following form.\n    What do you expect the value of $\\hat{\\beta}_1$, the estimated coefficient for *Dream*, to be?\n    Explain your reasoning.\n\n$$\n\\log\\Big(\\frac{\\pi}{1-\\pi}\\Big) = \\beta_0 + \\beta_1 ~ Dream + \\beta_2 ~ Torgersen\n$$\n\n4.  Fit a model predicting `adelie` from `island` and display the model output. For the following exercise, use this model.\n5.  Based on this model, what are the **odds** of a penguin being from the Adelie species if it was recorded on Biscoe island? on Dream island?\n6.  Next, add flipper length to the model so that there are two predictors. Display the model output. For the following exercises, use this model.\n7.  Write the regression equation for the model.\n8.  Interpret the coefficient of `flipper_length_mm` in terms of the log-odds of being from the Adelie species.\n9.  Interpret the coefficient of `flipper_length_mm` in terms of the odds of being from the Adelie species.\n10. Interpret the coefficient of `Dream` in terms of the odds of being from the Adelie species.\n11. How do you expect the log-odds of being from the Adelie species to change when going from a penguin with flipper length 185 mm to a penguin with flipper length 200 mm? Assume both penguins were recorded on the Dream island.\n12. How do you expect the odds of being from the Adelie species to change when going from a penguin with flipper length 185 mm to a penguin with flipper length 200 mm? Assume both penguins were recorded on the Dream island.\n\n## Part 2 - GDP and Urban population\n\nData on countries' Gross Domestic Product (GDP) and percentage of urban population was collected and made available by [The World Bank](http://data.worldbank.org/) in 2020.\nA description of the variables as defined by The World Bank are provided below.\n\n-   **GDP:** \"GDP per capita is gross domestic product divided by midyear population. GDP is the sum of gross value added by all resident producers in the economy plus any product taxes and minus any subsidies not included in the value of the products. It is calculated without making deductions for depreciation of fabricated assets or for depletion and degradation of natural resources. Data are in current U.S. dollars.\"\n-   **Urban Population (% of total):** \"Urban population refers to people living in urban areas as defined by national statistical offices. It is calculated using World Bank population estimates and urban ratios from the United Nations World Urbanization Prospects.\"\n\nThe data can be found in the `data` folder of your repository.\nRead the data and name it `gdp_2020`.\n\n13. Fit a model predicting GDP from urban population. Then make a plot of residuals vs. fitted for this model. Does the linear model seem appropriate for modeling this relationship? Explain your reasoning.\n14. Add a new column to the `gdp_2020` dataset called `gdp_log` which is the (natural) log of `gdp`.\n15. Fit a new model, predicting the log of GDP from urban population. Then make a plot of residuals vs. fitted for this model. Does the model predicting logged GDP or original GDP appear to be a better fit? Explain your reasoning.\n\nThe model output for predicting logged GDP.\n\n```{r}\n#| echo: false\n#| warning: false\n\ngdp2020 <- read_csv(here::here(\"hw\", \"data/gdp-2020.csv\"))\n\ngdp2020 <- gdp2020 %>%\n  mutate(gdp_log = log(gdp))\n\nlog_gdp_fit <- linear_reg() %>%\n  set_engine(\"lm\") %>%\n  fit(gdp_log ~ urban, data = gdp2020)\n\ntidy(log_gdp_fit) %>%\n  kable(digits = 3)\n```\n\nThe linear model for predicting log of GDP can be expressed as follows:\n\n$$\n\\widehat{\\log(GDP)} = 6.11 + 0.042 \\times urban\n$$\n\nTherefore, the coefficient of `urban` (0.042) can be interpreted as the change in logged GDP associated with 1 percentage point increase in urban population.\nThe problem is, logged GDP is not a very informative value to talk about.\nSo we need to undo the transformation we've done.\n\nTo do so, let's do a quick review of some properties of logs.\n\n-   Subtraction and logs: $log(a) − log(b) = log(\\frac{a}{b})$\n-   Natural logarithm: $e^{log(x)} = x$\n\nBased on the interpretation of the slope above, the difference between the predicted values of logged GDP for a given value of `urban` and a value that is 1 percentage point higher is 0.0425.\nLet's write this out mathematically, and then use the properties we've listed above to work through the equation.\n\n$$\n\\begin{aligned}\nlog(\\text{GDP for urban } x + 1) - log(\\text{GDP for urban } x) &= 0.042 \\\\\nlog\\Big( \\frac{\\text{GDP for urban } x + 1}{\\text{GDP for urban } x} \\Big) &= 0.042 \\\\\ne^{log\\Big( \\frac{\\text{GDP for urban } x + 1}{\\text{GDP for urban } x} \\Big)} &= e^{0.042}\\\\\n\\frac{\\text{GDP for urban } x + 1}{\\text{GDP for urban } x} &= e^{0.042}\n\\end{aligned}\n$$\n\n16. Based on the derivation above, fill in the blanks in the following sentence for an alternative (and more useful interpretation) of the slope of `urban`.\n\n    > For each additional percentage point the urban population is higher, the GDP of a country is expected to be \\_\\_\\_, on average, by a factor of \\_\\_\\_.\n\n## Submission\n\n::: callout-warning\nBefore you wrap up the assignment, make sure all documents are updated on your GitHub repo.\nWe will be checking these to make sure you have been practicing how to commit and push changes.\n\nRemember -- you must turn in a PDF file to the Gradescope page before the submission deadline for full credit.\n:::\n\nTo submit your assignment:\n\n-   Go to [http://www.gradescope.com](http://www.gradescope.com/) and click *Log in* in the top right corner.\n-   Click *School Credentials* ➡️ *Duke NetID* and log in using your NetID credentials.\n-   Click on your *STA 210* course.\n-   Click on the assignment, and you'll be prompted to submit it.\n-   Mark the pages associated with each exercise. All of the pages of your lab should be associated with at least one question (i.e., should be \"checked\").\n-   Select the first page of your PDF submission to be associated with the *\"Workflow & formatting\"* section.\n\n## Grading\n\nTotal points available: 50 points.\n\n| Component             | Points |\n|-----------------------|--------|\n| Ex 1 - 9              | 45     |\n| Workflow & formatting | 5[^1]  |\n\n[^1]: The \"Workflow & formatting\" grade is to assess the reproducible workflow.\n    This includes having at least 3 informative commit messages and updating the name and date in the YAML.\n","srcMarkdownNoYaml":"\n\n## Introduction\n\nIn this assignment, you'll get to put into practice the logistic regression skills you've developed.\n\n### Learning goals\n\nIn this assignment, you will...\n\n-   Fit and interpret logistic regression models.\n-   Fit and interpret multiple linear regression models with log transformed outcomes.\n-   Reason around log transformations of various types.\n-   Continue developing a workflow for reproducible data analysis.\n\n### Getting started\n\nYour repo for this assignment is at [github.com/sta210-s22](https://github.com/sta210-s22 \"Course GitHub organization\") and starts with the prefix **hw-3**.\nFor more detailed instructions on getting started, see [HW 1](hw-1.html).\n\n### Packages\n\nThe following packages will be used in this assignment.\nYou can add other packages as needed.\n\n```{r}\n#| message: false\n\nlibrary(tidyverse)\nlibrary(tidymodels)\nlibrary(knitr)\nlibrary(palmerpenguins)\n```\n\n## Part 1 - Palmer penguins\n\nIn this part we'll go back to the Palmer penguins dataset from [HW 2](hw-2.html).\n\nWe will use the following variables:\n\n| variable          | class   | description                                      |\n|:--------------|:--------------|:-----------------------------------------|\n| species           | integer | Penguin species (Adelie, Gentoo, Chinstrap)      |\n| island            | integer | Island where recorded (Biscoe, Dream, Torgersen) |\n| flipper_length_mm | integer | Flipper length in mm                             |\n\nThe goal of this analysis is to use logistic regression to understand the relationship between flipper length, island, and whether a penguin is from the Adelie species.\nFirst, we need to create a new response variable to identify whether a penguin is from the Adelie species.\n\n```{r}\npenguins <- penguins %>%\n  mutate(adelie = factor(if_else(species == \"Adelie\", 1, 0)))\n```\n\nAnd let's check to make sure the new variable looks right before we continue with the analysis.\n\n```{r}\npenguins %>%\n  count(adelie, species)\n```\n\nLet's start by looking at the relationship between island and whether a penguin is from the Adelie species.\n\n1.  What does the `values_fill` argument do in the following chunk?\n    The documentation for the function will be helpful in answering this question.\n\n    ```{r}\n    penguins %>%\n      count(island, adelie) %>%\n      pivot_wider(names_from = adelie, values_from = n, values_fill = 0)\n    ```\n\n2.  Calculate the odds ratio of a penguin being from the Adelie species for those recorded on Dream compared to those recorded on Biscoe.\n\n3.  You want to fit a model using `island` to predict the odds of being from the Adelie species.\n    Let $\\pi$ be the probability a penguin is from the Adelie species.\n    The model has the following form.\n    What do you expect the value of $\\hat{\\beta}_1$, the estimated coefficient for *Dream*, to be?\n    Explain your reasoning.\n\n$$\n\\log\\Big(\\frac{\\pi}{1-\\pi}\\Big) = \\beta_0 + \\beta_1 ~ Dream + \\beta_2 ~ Torgersen\n$$\n\n4.  Fit a model predicting `adelie` from `island` and display the model output. For the following exercise, use this model.\n5.  Based on this model, what are the **odds** of a penguin being from the Adelie species if it was recorded on Biscoe island? on Dream island?\n6.  Next, add flipper length to the model so that there are two predictors. Display the model output. For the following exercises, use this model.\n7.  Write the regression equation for the model.\n8.  Interpret the coefficient of `flipper_length_mm` in terms of the log-odds of being from the Adelie species.\n9.  Interpret the coefficient of `flipper_length_mm` in terms of the odds of being from the Adelie species.\n10. Interpret the coefficient of `Dream` in terms of the odds of being from the Adelie species.\n11. How do you expect the log-odds of being from the Adelie species to change when going from a penguin with flipper length 185 mm to a penguin with flipper length 200 mm? Assume both penguins were recorded on the Dream island.\n12. How do you expect the odds of being from the Adelie species to change when going from a penguin with flipper length 185 mm to a penguin with flipper length 200 mm? Assume both penguins were recorded on the Dream island.\n\n## Part 2 - GDP and Urban population\n\nData on countries' Gross Domestic Product (GDP) and percentage of urban population was collected and made available by [The World Bank](http://data.worldbank.org/) in 2020.\nA description of the variables as defined by The World Bank are provided below.\n\n-   **GDP:** \"GDP per capita is gross domestic product divided by midyear population. GDP is the sum of gross value added by all resident producers in the economy plus any product taxes and minus any subsidies not included in the value of the products. It is calculated without making deductions for depreciation of fabricated assets or for depletion and degradation of natural resources. Data are in current U.S. dollars.\"\n-   **Urban Population (% of total):** \"Urban population refers to people living in urban areas as defined by national statistical offices. It is calculated using World Bank population estimates and urban ratios from the United Nations World Urbanization Prospects.\"\n\nThe data can be found in the `data` folder of your repository.\nRead the data and name it `gdp_2020`.\n\n13. Fit a model predicting GDP from urban population. Then make a plot of residuals vs. fitted for this model. Does the linear model seem appropriate for modeling this relationship? Explain your reasoning.\n14. Add a new column to the `gdp_2020` dataset called `gdp_log` which is the (natural) log of `gdp`.\n15. Fit a new model, predicting the log of GDP from urban population. Then make a plot of residuals vs. fitted for this model. Does the model predicting logged GDP or original GDP appear to be a better fit? Explain your reasoning.\n\nThe model output for predicting logged GDP.\n\n```{r}\n#| echo: false\n#| warning: false\n\ngdp2020 <- read_csv(here::here(\"hw\", \"data/gdp-2020.csv\"))\n\ngdp2020 <- gdp2020 %>%\n  mutate(gdp_log = log(gdp))\n\nlog_gdp_fit <- linear_reg() %>%\n  set_engine(\"lm\") %>%\n  fit(gdp_log ~ urban, data = gdp2020)\n\ntidy(log_gdp_fit) %>%\n  kable(digits = 3)\n```\n\nThe linear model for predicting log of GDP can be expressed as follows:\n\n$$\n\\widehat{\\log(GDP)} = 6.11 + 0.042 \\times urban\n$$\n\nTherefore, the coefficient of `urban` (0.042) can be interpreted as the change in logged GDP associated with 1 percentage point increase in urban population.\nThe problem is, logged GDP is not a very informative value to talk about.\nSo we need to undo the transformation we've done.\n\nTo do so, let's do a quick review of some properties of logs.\n\n-   Subtraction and logs: $log(a) − log(b) = log(\\frac{a}{b})$\n-   Natural logarithm: $e^{log(x)} = x$\n\nBased on the interpretation of the slope above, the difference between the predicted values of logged GDP for a given value of `urban` and a value that is 1 percentage point higher is 0.0425.\nLet's write this out mathematically, and then use the properties we've listed above to work through the equation.\n\n$$\n\\begin{aligned}\nlog(\\text{GDP for urban } x + 1) - log(\\text{GDP for urban } x) &= 0.042 \\\\\nlog\\Big( \\frac{\\text{GDP for urban } x + 1}{\\text{GDP for urban } x} \\Big) &= 0.042 \\\\\ne^{log\\Big( \\frac{\\text{GDP for urban } x + 1}{\\text{GDP for urban } x} \\Big)} &= e^{0.042}\\\\\n\\frac{\\text{GDP for urban } x + 1}{\\text{GDP for urban } x} &= e^{0.042}\n\\end{aligned}\n$$\n\n16. Based on the derivation above, fill in the blanks in the following sentence for an alternative (and more useful interpretation) of the slope of `urban`.\n\n    > For each additional percentage point the urban population is higher, the GDP of a country is expected to be \\_\\_\\_, on average, by a factor of \\_\\_\\_.\n\n## Submission\n\n::: callout-warning\nBefore you wrap up the assignment, make sure all documents are updated on your GitHub repo.\nWe will be checking these to make sure you have been practicing how to commit and push changes.\n\nRemember -- you must turn in a PDF file to the Gradescope page before the submission deadline for full credit.\n:::\n\nTo submit your assignment:\n\n-   Go to [http://www.gradescope.com](http://www.gradescope.com/) and click *Log in* in the top right corner.\n-   Click *School Credentials* ➡️ *Duke NetID* and log in using your NetID credentials.\n-   Click on your *STA 210* course.\n-   Click on the assignment, and you'll be prompted to submit it.\n-   Mark the pages associated with each exercise. All of the pages of your lab should be associated with at least one question (i.e., should be \"checked\").\n-   Select the first page of your PDF submission to be associated with the *\"Workflow & formatting\"* section.\n\n## Grading\n\nTotal points available: 50 points.\n\n| Component             | Points |\n|-----------------------|--------|\n| Ex 1 - 9              | 45     |\n| Workflow & formatting | 5[^1]  |\n\n[^1]: The \"Workflow & formatting\" grade is to assess the reproducible workflow.\n    This includes having at least 3 informative commit messages and updating the name and date in the YAML.\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":"auto","echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"wrap","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"output-file":"hw-3.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.5.45","editor":"visual","theme":{"light":["cosmo","../theme.scss"],"dark":["cosmo","../theme-dark.scss"]},"mainfont":"Atkinson Hyperlegible","code-copy":true,"title":"HW 3 - Logistic regression and log transformation","subtitle":"Due Friday, March 25, 5pm on Gradescope"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}